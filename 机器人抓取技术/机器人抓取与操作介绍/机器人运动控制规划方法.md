# 学习笔记：机器人运动控制与规划方法

> 本笔记旨在系统性地梳理机器人学中从位姿表示、运动学、路径规划到最终控制的完整技术链路。内容涵盖了核心的数学基础、经典与现代的运动学解法、主流的规划算法以及常用的控制理论。

---

## 第一部分：数学基础：姿态描述与坐标变换

在控制机器人之前，我们必须能够精确地描述其在空间中的位置（Position）和姿态（Orientation），统称为位姿（Pose）。

### 1. 旋转、坐标系及坐标变换

* **坐标系 (Frame):** 机器人学中通常使用右手坐标系。关键坐标系包括：
    * **世界坐标系 / 固定坐标系 ({S}):** 一个静止的、作为全局参考的坐标系。
    * **物体/连杆坐标系 ({B}):** 一个固连在机器人某个部件（如末端执行器）上的坐标系。
* **坐标变换:** 同一个点 $P$ 在不同坐标系下的坐标是不同的。坐标变换就是描述这些坐标之间的关系。一个刚体位姿变换可以由一个旋转 $ R $ 和一个平移 $p$ 组成。
    * 点 $p_A$ 在坐标系 {A} 中的坐标，可以通过变换矩阵 $T_{AB}$ 得到其在坐标系 {B} 中的坐标 $p_B$：$p_B = R_{AB} p_A + p_{o_B}$。
    * 使用齐次变换矩阵可以统一表达：
        $$
        \begin{bmatrix} p_B \\ 1 \end{bmatrix} = T_{BA} \begin{bmatrix} p_A \\ 1 \end{bmatrix} \quad \text{其中} \quad T_{BA} = \begin{bmatrix} R_{BA} & p_{o_A} \\ 0 & 1 \end{bmatrix}
        $$

### 2. 旋转的表示方法

描述旋转有多种方法，各有优劣。

#### a. 旋转矩阵 (Rotation Matrix)

* **定义:** 一个 $3 \times 3$ 的矩阵 $R$，用于描述一个坐标系相对于另一个坐标系的方向。
* **性质:** 是一个正交矩阵 ($R^T R = I$) 且行列式为 1 ($\det(R)=1$)。所有旋转矩阵的集合构成了**特殊正交群 SO(3)**。
* **优点:**
    * 表达直观，无奇异性。
    * 方便进行坐标变换和矩阵运算。
* **缺点:**
    * 需要 9 个参数来表示 3 个自由度的旋转，存在冗余。
    * 参数不独立，不便于优化和插值。

#### b. 欧拉角 (Euler Angles)

* **定义:** 将一个旋转分解为绕三个主轴（可以是固定的轴或自身旋转的轴）的连续三次旋转。最常见的组合是 `Z-Y-X` (偏航-俯仰-滚转, Yaw-Pitch-Roll)。
* **自身旋转 vs 固定坐标系旋转:**
    * **固定坐标系旋转 (Extrinsic):** 每次旋转都绕着固定的世界坐标系的轴进行。
    * **自身坐标系旋转 (Intrinsic):** 第一次旋转绕世界坐标系，后续每次旋转都绕着物体自身当前已被旋转过的坐标系的轴进行。有趣的是，按 `Z-Y-X` 顺序的自身旋转结果等价于按 `X-Y-Z` 顺序的固定坐标系旋转。
* **优点:**
    * 非常直观，只有 3 个参数，符合人类思维。
* **缺点:**
    * **万向锁 (Gimbal Lock):** 当中间的旋转轴（如俯仰角 Pitch）旋转到 $\pm 90^\circ$ 时，第一次和第三次旋转的轴会重合，导致系统丢失一个旋转自由度。这是欧拉角的**致命缺陷**。
    * 表示不唯一（同一个旋转可以有多组欧拉角）。

#### c. 轴角 (Axis-Angle)

* **定义:** 任何旋转都可以看作是绕着某个单位向量轴 $\hat{\omega}$ 旋转一个角度 $\theta$。用 $(\hat{\omega}, \theta)$ 来表示。
* **优点:**
    * 几何意义清晰。
    * 比旋转矩阵更紧凑（4个参数，实际3个自由度）。
* **缺点:**
    * 不便于直接进行旋转的复合运算。
    * $\theta = 0$ 时 $\hat{\omega}$ 未定义，存在表示不唯一的轻微问题。

#### d. 四元数 (Quaternion)

* **定义:** 一个扩展的复数，形式为 $q = w + x\mathbf{i} + y\mathbf{j} + z\mathbf{k}$，其中 $w,x,y,z$ 是实数。对于单位四元数（$w^2+x^2+y^2+z^2=1$），它可以用来表示三维旋转。
* **与轴角的关系:**
    $$
    q = \left( \cos\frac{\theta}{2}, \hat{\omega}_x \sin\frac{\theta}{2}, \hat{\omega}_y \sin\frac{\theta}{2}, \hat{\omega}_z \sin\frac{\theta}{2} \right)
    $$
* **优点:**
    * **无奇异性:** 完美规避了万向锁问题。
    * **紧凑:** 仅用 4 个数表示旋转。
    * **计算高效:** 旋转的复合运算（四元数乘法）比矩阵乘法计算量小。
    * **便于插值:** 可以使用球面线性插值(SLERP)实现平滑的旋转过渡。
* **缺点:**
    * 不如欧拉角直观，理解上稍有难度。

### 3. 李群与李代数基础

* **特殊欧式群 SE(3):** 所有 $4 \times 4$ 齐次变换矩阵的集合。它是一个李群，描述了刚体在三维空间中的所有位姿。
* **特殊正交群 SO(3):** 所有 $3 \times 3$ 旋转矩阵的集合，是 SE(3) 的子群。
* **李代数:** 每个李群在单位元附近都有一个对应的向量空间，称为李代数。
    * $SO(3)$ 对应的李代数是 $\mathfrak{so}(3)$，是所有 $3 \times 3$ 的反对称矩阵的集合。任何一个三维向量 $\omega = [\omega_1, \omega_2, \omega_3]^T$ 都可以映射到一个反对称矩阵 $[\omega]$:
        $$
        [\omega] = \begin{bmatrix} 0 & -\omega_3 & \omega_2 \\ \omega_3 & 0 & -\omega_1 \\ -\omega_2 & \omega_1 & 0 \end{bmatrix}
        $$
    * $SE(3)$ 对应的李代数是 $\mathfrak{se}(3)$，是所有 $4 \times 4$ 的螺旋运动矩阵的集合。
* **指数映射:** 李代数到李群的映射。
    * **旋转:** $R = e^{[\omega]\theta}$ (罗德里格斯公式)。$\omega\theta$ 是旋转向量。
    * **变换:** $T = e^{[\mathcal{S}]\theta}$ (指数积公式)。

---

## 第二部分：运动学 (Kinematics)

运动学研究机器人的运动几何，不考虑力与质量。

### 1. 正运动学 (Forward Kinematics - FK)

> **问题:** 已知所有关节变量（角度或长度），计算末端执行器在世界坐标系下的位姿。

#### a. DH 参数法 (Denavit-Hartenberg)

* **思想:** 为每个连杆建立一个坐标系，通过一套标准化的四个参数来描述相邻连杆坐标系之间的关系。
* **四个参数:**
    1.  **$a_{i-1}$ (link length):** $Z_{i-1}$ 和 $Z_i$ 轴之间的公垂线长度。
    2.  **$\alpha_{i-1}$ (link twist):** $Z_{i-1}$ 和 $Z_i$ 轴之间的夹角。
    3.  **$d_i$ (link offset):** $X_{i-1}$ 和 $X_i$ 轴沿 $Z_i$ 轴的距离。
    4.  **$\theta_i$ (joint angle):** $X_{i-1}$ 和 $X_i$ 轴绕 $Z_i$ 轴的夹角。
* **求解:** 对于一个N自由度机械臂，总的变换矩阵是各个连杆变换矩阵的连乘：
    $$
    T^0_N = T^0_1(\theta_1) T^1_2(\theta_2) \cdots T^{N-1}_N(\theta_N)
    $$
* **分类:** 存在标准DH和改进DH (MDH) 两种约定，主要区别在于坐标系建立的位置。

#### b. POE (Product of Exponentials) / 指数积

* **思想:** 任何刚体运动都可以通过一个螺旋运动（Screw Motion）来实现。一个开环机械臂的运动可以看作是各个关节的螺旋运动的累积效应。
* **螺旋运动:** 同时包含旋转和沿旋转轴的平移。由一个轴向量 $S$ 和一个标量 $\theta$ 描述。
* **求解:** FK变换矩阵由初始位姿 $M$ 和一系列指数积构成：
    $$
    T(\theta) = e^{[\mathcal{S}_1]\theta_1} e^{[\mathcal{S}_2]\theta_2} \cdots e^{[\mathcal{S}_n]\theta_n} M
    $$
    其中，$\mathcal{S}_i$ 是第 $i$ 个关节在初始（零角度）构型下的螺旋轴，$M$ 是零角度时末端的位姿。
* **优点:**
    * 概念统一，无需为每个连杆单独建立坐标系。
    * 避免了DH参数法在某些情况下（如平行轴）的奇异性问题。

### 2. 微分运动学 (Differential Kinematics)

> 研究关节速度与末端执行器速度之间的关系。

* **雅可比矩阵 (Jacobian):** 一个线性映射，将关节空间的速度 $\dot{q}$ 映射到笛卡尔空间（任务空间）的速度 $\mathcal{V}$。
    $$
    \mathcal{V} = J(q) \dot{q}
    $$
    其中 $\mathcal{V} = [\dot{p}^T, \omega^T]^T$ 是末端的线速度和角速度，$\dot{q}$ 是关节速度向量。
* **重要应用:**
    * **奇异点分析:** 当 $\det(J(q))=0$ 时，机械臂处于奇异位形。此时，机械臂会丢失一个或多个方向的运动能力。
    * **逆运动学求解:** 是数值解法的基础。
    * **力/速度控制:** 建立任务空间和关节空间的映射关系。

### 3. 逆运动学 (Inverse Kinematics - IK)

> **问题:** 已知末端执行器的目标位姿，反解出对应的关节变量。

IK 是机器人学中最核心也最困难的问题之一，因为它通常是非线性的，且可能存在多解、无解或无穷解。

* **求解方法:**
    1.  **解析解 (Analytical Solutions):**
        * **方法:** 通过代数或几何方法直接推导出封闭形式的解。
        * **适用性:** 仅适用于结构简单的机器人（如球腕结构的6轴机器人）。
        * **优点:** 速度快、能求出所有解。
    2.  **数值解 (Numerical Solutions):**
        * **方法:** 基于雅可比矩阵的迭代法，如牛顿-拉夫逊法。
            $$
            q_{k+1} = q_k + J^\dagger(q_k) (\mathcal{V}_{desired} - \mathcal{V}_{current})
            $$
            其中 $J^\dagger$ 是雅可比的伪逆。
        * **优点:** 通用性强，适用于任何结构的机器人。
        * **缺点:** 依赖于初始值、可能陷入局部最优、在奇异点附近不稳定。

---

## 第三部分：运动规划 (Motion Planning)

> **问题:** 在给定的环境中，找到一条从起点到终点的有效路径，同时满足各种约束（如避障、关节限位等）。

### 1. 规划控制架构

* **任务规划 (Task Planning):** 高层决策，将复杂任务分解为一系列简单的子任务。
* **运动规划 (Motion Planning):** 中层决策，为每个子任务生成一条具体的、无碰撞的路径。
* **轨迹规划 (Trajectory Planning):** 底层决策，在路径上加入时间信息，生成速度、加速度曲线，使其平滑并满足动力学约束。

### 2. 规划空间

* **任务空间 (Task Space):** 末端执行器所在的笛卡尔空间。规划直观，但需要频繁求解IK，且可能遇到奇异点。
* **关节空间 (Configuration Space / C-Space):** 由所有关节变量构成的空间。
    * **优点:** 机器人被简化为一个点，障碍物被映射为C-Space中的障碍区域。直接避免了IK求解和奇异点问题。
    * **缺点:** C-Space障碍物的精确计算非常复杂。

### 3. 路径规划方法

#### a. 基于采样的方法 (Sampling-based)

核心思想是通过在C-Space中随机采样来探索可行区域，并构建一个图来连接起点和终点，避免了对C-Space障碍物的显式计算。

* **PRM (Probabilistic Roadmap):**
    1.  **学习阶段:** 在C-Space中随机撒点，保留有效点（不在障碍物内），并尝试连接邻近的点，构建一个“路线图”。
    2.  **查询阶段:** 将起点和终点连接到图中，然后用图搜索算法（如A*）找到路径。
    * **优点:** 擅长处理多查询任务。
    * **缺点:** 难以在狭窄通道中采样。

* **RRT (Rapidly-exploring Random Tree):**
    1.  从起点开始，生成一棵树。
    2.  循环：在C-Space中随机采样一个点，在树上找到离它最近的节点，然后从该节点向采样点延伸一小步，如果新节点有效，则加入树中。
    3.  当树的节点足够靠近终点时，规划成功。
    * **优点:** 探索性强，特别适合解决单查询和高维空间问题。
    * **变种:** RRT-Connect (双向搜索), RRT* (渐进最优)。

---

## 第四部分：控制 (Control)

> **问题:** 设计控制器，使得机器人能够精确、稳定地执行规划好的轨迹。

### 1. 控制系统建模方法

* **拉格朗日法:** 从系统的能量（动能和势能）出发，建立动力学方程。
    $$
    \tau = M(q)\ddot{q} + C(q, \dot{q})\dot{q} + G(q)
    $$
    其中 $\tau$ 是关节力矩，$M(q)$ 是惯性矩阵，$C(q, \dot{q})$ 是科里奥利力和离心力项，$G(q)$ 是重力项。
* **牛顿-欧拉法:** 对每个连杆进行力/力矩分析，通过迭代递推得到动力学方程。

### 2. 核心控制算法

#### a. PID 控制 (Proportional-Integral-Derivative)

* **思想:** 基于输出与期望之间的误差 $e(t)$ 来计算控制量。
    $$
    u(t) = K_p e(t) + K_i \int_0^t e(\tau) d\tau + K_d \frac{de(t)}{dt}
    $$
    * **P (比例):** 响应当前误差。
    * **I (积分):** 消除稳态误差。
    * **D (微分):** 预测未来误差，抑制振荡。
* **优点:** 简单、鲁棒、应用最广泛。
* **缺点:** 参数整定困难，对复杂非线性系统效果有限。

#### b. MPC (Model Predictive Control)

* **思想:** 在每个控制周期，基于当前状态和系统的动力学模型，预测未来一段时间内的系统行为。通过在线优化，找到一个最优的控制序列，并执行该序列的第一个控制量。
* **核心步骤:**
    1.  **预测 (Prediction):** 使用模型预测未来状态。
    2.  **优化 (Optimization):** 在满足约束的条件下，求解一个使目标函数（如跟踪误差、能耗）最小的最优控制问题。
    3.  **滚动执行 (Receding Horizon):** 只执行当前时刻的控制输入，并在下一时刻重复整个过程。
* **优点:**
    * 能显式处理多变量和约束。
    * 前瞻性，控制性能好。
* **缺点:** 计算量大，对模型的精度要求高。

### 3. 控制应用

* **关节模组控制:** 最底层的控制，直接控制每个关节的位置、速度或力矩。这是所有上层控制的基础。
* **笛卡尔空间到关节控制:**
    * **计算力矩控制:** 通过精确的动力学模型，计算出所需的关节力矩以抵消系统的非线性效应，实现解耦和线性化控制。
    * **操作空间控制:** 将控制目标直接定义在笛卡尔空间（如末端位置、力），然后通过雅可比矩阵等工具映射到关节力矩。
* **力控 (Force Control):**
    * 当机器人需要与环境进行交互时（如打磨、装配），需要同时控制力和位置。
    * **阻抗/导纳控制:** 目标不是精确跟踪位置，而是让机器人在与环境接触时表现出期望的动态特性（如弹簧-阻尼系统），实现柔顺的交互。

```
